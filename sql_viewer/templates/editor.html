{% from "_macros.html" import database_navbar, sql_editor %}


{% extends "base.html" %}
{% block title %}
SQL Viewer | Title
{% endblock title %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="/static/css/codemirror.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.32.0/codemirror.min.css" />
<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.32.0/codemirror.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/codemirror@5.63.3/mode/sql/sql.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/codemirror@5.63.3/keymap/sublime.js"></script>
{% endblock head %}

{% block content %}
<main class="flex h-screen">
  {{ database_navbar(database_schema) }}
  <div class="w-[calc(100vw-24rem)] overflow-auto flex flex-col">
    {{ sql_editor() }}
    {% if entries %}
    <div class="h-[calc(50vh-3rem)] overflow-auto bg-[#121212]">
      <table class="w-full text-sm relative">
        <thead class="border-b border-[#323232] sticky top-0">
          <tr class="bg-[#121212] text-left">
            {% for column_name in entries.schema %}
            <th class="py-2 px-4 transition hover:bg-[#323232]">
              {{ column_name }}
            </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for item in entries.results %}
          <tr class="{{ 'bg-[#161616]' if loop.index0 % 2 == 0 else 'bg-[#121212]' }}">
            {% for value in item %}
            <td class="py-2 px-4 truncate hover:bg-[#323232]">{{ value }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="border-t border-[#323232] px-4 h-[3rem] flex items-center justify-between">
      <p><b>Time:</b> {{ "%.5f"|format(time) }}s</p>
      <p><b>Items:</b> {{ items }}</p>
    </div>
    {% else %}
    <div class="h-[50vh] bg-[#121212] flex items-center justify-center">
      <h3 class="text-3xl text-[#565656] tracking-tighter text-center">Write your query in the editor to get a view of
        the
        results
      </h3>
    </div>
    {% endif %}
  </div>
</main>
{% endblock content %}

{% block scripts %}
<script type="text/javascript" src="/static/js/table.js"></script>
{% endblock %}
